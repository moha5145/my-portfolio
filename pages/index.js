import { useEffect } from "react";

import { useRouter } from "next/router";
import { serverSideTranslations } from "next-i18next/serverSideTranslations";

import Head from "next/head";
import Navbar from "../components/nav/Navbar";
import Main from "../components/Main";
import About from "../components/About";
import Projects from "../components/projects/Projects";
import Skills from "../components/Skills";
import Contact from "../components/contact/Contact";
import Footer from "../components/Footer";

export async function getStaticProps({ locale }) {
  return {
    props: {
      ...(await serverSideTranslations(locale, ["common"])),
    },
  };
}

export default function Home({ locale }) {
  const addNavClass = (color) => {
    const body = document.querySelector(".body");
    const nav = document.querySelector(".nav");

    body.classList.add(color);
    nav.classList.add(color);
  };

  const removeNavClass = (color) => {
    const body = document.querySelector(".body");
    const nav = document.querySelector(".nav");

    body.classList.remove(color);
    nav.classList.remove(color);
  };

  const addLinkClass = (index, color) => {
    const links = document.querySelectorAll(".link");
    links[index].classList.add(color);
  };

  const removeLinkClass = (index, color) => {
    const links = document.querySelectorAll(".link");
    links[index].classList.remove(color);
  };

  useEffect(() => {
    const sections = document.querySelectorAll("section");
    const links = document.querySelectorAll(".link");

    window.onscroll = () => {
      for (let i = 0; i < sections.length; i++) {
        if (sections[0].getBoundingClientRect().top <= 0 && sections[0].getBoundingClientRect().bottom > 0 && sections[0]) {
          addLinkClass(0, "bg-main");
          addNavClass("bg-mainDark");
        } else {
          removeLinkClass(0, "bg-main");
          removeNavClass("bg-mainDark");
        }

        if (sections[1].getBoundingClientRect().top <= 0 && sections[1].getBoundingClientRect().bottom > 0 && sections[1]) {
          addLinkClass(1, "bg-projects");
          addNavClass("bg-projectsDark");
        } else {
          removeLinkClass(1, "bg-projects");
          removeNavClass("bg-projectsDark");
        }
        if (sections[2].getBoundingClientRect().top <= 0 && sections[2].getBoundingClientRect().bottom > 0 && sections[1] && sections[2]) {
          addLinkClass(2, "bg-skills");
          addNavClass("bg-skillsDark");
        } else {
          removeLinkClass(2, "bg-skills");
          removeNavClass("bg-skillsDark");
        }
        if (sections[3].getBoundingClientRect().top <= 0 && sections[3].getBoundingClientRect().bottom > 0 && sections[1] && sections[3]) {
          addLinkClass(3, "bg-about");
          addNavClass("bg-aboutDark");
        } else {
          removeLinkClass(3, "bg-about");
          removeNavClass("bg-aboutDark");
        }

        if (sections[4].getBoundingClientRect().top <= 0 && sections[4].getBoundingClientRect().bottom > 0 && sections[1] && sections[4]) {
          addLinkClass(4, "bg-contact");
          addNavClass("bg-contactDark");
        } else {
          removeLinkClass(4, "bg-contact");
          removeNavClass("bg-contactDark");
        }
      }
    };
  }, []);

  return (
    <div>
      <Head>
        <title>My portfolio</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <Navbar />
      <div className="pl-10 md:pl-28 text-slate-200 scroll-smoot body bg-mainDark">
        <Main />

        <Projects />

        <Skills />

        <About />

        <Contact />

        <Footer />
      </div>
    </div>
  );
}
